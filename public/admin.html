<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SustainWear Admin Dashboard</title>
<link rel="stylesheet" href="admin-dashboard.css">
</head>

<body>

<div class="layout">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-title">SustainWear Admin</div>
    <ul>
      <li onclick="showSection('dashboard')" class="active">Dashboard</li>
      <li onclick="showSection('leaderboard')">Leaderboard</li>
    </ul>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="content">

    <!--DASHBOARD  -->
    <section id="dashboard">

      <h1>Admin Dashboard</h1>

      <div class="stats-grid">
        <div class="stat-card">
          <p class="label">Total Users</p>
          <p class="value" id="statTotalUsers">0</p>
        </div>

        <div class="stat-card">
          <p class="label">Donors</p>
          <p class="value" id="statTotalDonors">0</p>
        </div>

        <div class="stat-card">
          <p class="label">Approved Staff</p>
          <p class="value" id="statStaffApproved">0</p>
        </div>

        <div class="stat-card">
          <p class="label">Pending Staff</p>
          <p class="value" id="statStaffPending">0</p>
        </div>
      </div>

      <h2>User Accounts</h2>
      <table class="data-table">
        <thead>
          <tr>
            <th>ID</th><th>Name</th><th>Email</th><th>Role</th><th>Status</th>
          </tr>
        </thead>
        <tbody id="usersTableBody"></tbody>
      </table>

      <h2>Pending Staff Accounts</h2>
      <ul id="staffList" class="list"></ul>

    </section>

    <!--  LEADERBOARD  -->
    <section id="leaderboard" style="display:none;">

      <h1>Donation Leaderboard</h1>

      <div class="row">
        <div class="col stat-card">
          <div class="stat-label">Most Donated Category</div>
          <div class="stat-value" id="topCategory">–</div>
        </div>

        <div class="col stat-card">
          <div class="stat-label">Most Donated Size</div>
          <div class="stat-value" id="topSize">–</div>
        </div>
      </div>

    </section>

  </main>
</div>

<script>
async function loadStats() {
  const res = await fetch("/admin/stats");
  const s = await res.json();

  statTotalUsers.textContent = s.totalUsers;
  statTotalDonors.textContent = s.totalDonors;
  statStaffApproved.textContent = s.staffApproved;
  statStaffPending.textContent = s.staffPending;
}

async function loadUsers() {
  const res = await fetch("/admin/users");
  const users = await res.json();
  usersTableBody.innerHTML = "";
  users.forEach(u => {
    usersTableBody.innerHTML += `
      <tr>
        <td>${u.id}</td>
        <td>${u.name}</td>
        <td>${u.email}</td>
        <td>${u.role}</td>
        <td>${u.status}</td>
      </tr>`;
  });
}

async function loadStaff() {
  const res = await fetch("/admin/pending-staff");
  const staff = await res.json();
  staffList.innerHTML = "";
  staff.forEach(u => {
    staffList.innerHTML += `
      <li>
        <b>${u.name}</b> (${u.email})
        <button onclick="approveStaff(${u.id})">Approve</button>
        <button onclick="rejectStaff(${u.id})">Reject</button>
      </li>`;
  });
}

function approveStaff(id) {
  fetch("/admin/approve", {
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify({ id })
  }).then(refreshAll);
}

function rejectStaff(id) {
  fetch("/admin/reject", {
    method: "POST",
    headers: { "Content-Type":"application/json" },
    body: JSON.stringify({ id })
  }).then(refreshAll);
}

async function loadLeaderboard() {
  const res = await fetch("/admin/leaderboard");
  const data = await res.json();
  topCategory.textContent = data.topCategory;
  topSize.textContent = data.topSize;
}

function showSection(section) {
  dashboard.style.display = section === "dashboard" ? "block" : "none";
  leaderboard.style.display = section === "leaderboard" ? "block" : "none";

  if (section === "leaderboard") loadLeaderboard();
}

function refreshAll() {
  loadStats();
  loadUsers();
  loadStaff();
}

refreshAll();
</script>

</body>
</html>
